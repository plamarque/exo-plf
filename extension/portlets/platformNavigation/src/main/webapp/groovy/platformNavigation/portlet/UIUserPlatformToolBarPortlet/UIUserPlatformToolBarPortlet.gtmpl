<%
import org.exoplatform.portal.webui.util.Util;
import org.exoplatform.portal.mop.user.UserNavigation;
import org.exoplatform.portal.mop.user.UserNode;
import org.exoplatform.web.application.JavascriptManager;
import org.exoplatform.platform.component.social.UINavigationComposer;

def rcontext = _ctx.getRequestContext() ;
JavascriptManager jsmanager = rcontext.getJavascriptManager();
jsmanager.importJavascript('eXo.portal.UIPortalNavigation') ;
jsmanager.importJavascript('eXo.portal.UIAdminToolbar') ;
jsmanager.addCustomizedOnLoadScript('eXo.portal.UIAdminToolbar.onLoad("' + uicomponent.id + '");');

def user = uicomponent.getUser();

def portalURI = Util.getPortalRequestContext().getPortalURI();
def labelActivities = _ctx.appRes("UIUserPlatformToolBarPortlet.label.activities");
def labelProfile = _ctx.appRes("UIUserPlatformToolBarPortlet.label.profile");
def labelnetwork = _ctx.appRes("UIUserPlatformToolBarPortlet.label.network");
def labelpeople = _ctx.appRes("UIUserPlatformToolBarPortlet.label.find");
def labelaccount = _ctx.appRes("UIUserPlatformToolBarPortlet.label.account");
def labellanguage = _ctx.appRes("UIUserPlatformToolBarPortlet.label.language");
def labellogout = _ctx.appRes("UIUserPlatformToolBarPortlet.label.logout");
def remoteUser = Util.getPortalRequestContext().getRemoteUser();
def activitiesLink = portalURI + "activities";
def profileLink = portalURI + "profile/" + remoteUser;
def connectionLink = portalURI + "connections/myConnections/" + remoteUser;
def directoryLink = portalURI + "people";
def changeLanguageAction = "if(document.getElementById('UIMaskWorkspace')) ajaxGet(eXo.env.server.createPortalURL('UIPortal', 'ChangeLanguage', true));";
def accountSetting = "javascript:if(document.getElementById('UIMaskWorkspace')) ajaxGet(eXo.env.server.createPortalURL('UIPortal', 'AccountSettings', true));"
String clazz = "";
%>
<ul class="UIUserToolBarPortlet UIHorizontalTabs" id="$uicomponent.id" style="position: relative">
	<li id="UserNavigationTabsContainer" class="UITab">
		<a class="TBIcon" href="#">
			   $user.fullName
		</a>
		<ul style="position: absolute; display:none;width:350px;" class="MenuItemContainer">
			<%if(uicomponent.isSocialPortal()) {%>
				<% uicomponent.renderChild(UINavigationComposer.class) %>
				<li style="float: left;width: 80%;">
					<ul>
					<li class="MenuItem $clazz" style="float: left;width: 50%;">
						<a href="$profileLink" class="ToolBarProfileIcon">$labelProfile</a>
					</li>
					<li class="MenuItem $clazz" style="float: right;width: 50%;">
						<a href="$activitiesLink" class="ToolBarActivityIcon">$labelActivities</a>
					</li>
					<br/>
					<li class="MenuItem $clazz" style="float: left;width: 50%;">
						<a href="$connectionLink" class="ToolBarNetworkIcon">$labelnetwork</a>
					</li>
					<li class="MenuItem $clazz" style="float: right;width: 50%;">
						<a href="$directoryLink" class="FindPeopleIcon">$labelpeople</a>
					</li>
					</ul>
				</li>
				<hr width="100%" style="width:100%; color: #999999;clear: both; margin: 0;" />
			<%}%>
			<li class="MenuItem $clazz" style="float: left;width: 50%;">
				<a href="$accountSetting" class="AccountSettingIcon">$labelaccount</a>				
			</li>       
			<li class="MenuItem $clazz" onclick="$changeLanguageAction" style="float: right;width: 50%;">
				<a href="#" class="ChangeLanguageIcon">$labellanguage</a>
			</li>
			<br/>
			<hr width="100%" style="width:100%; color: #999999; margin: 0;" />			
			<li class="MenuItem $clazz" onclick="eXo.portal.logout();">
				<a href="#" class="LogoutIcon">$labellogout</a> 						
			</li>
		</ul>
	</li>
</ul>